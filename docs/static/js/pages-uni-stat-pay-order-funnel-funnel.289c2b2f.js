(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-uni-stat-pay-order-funnel-funnel"],{"0dd9":function(t,e,a){var n=a("c86c");e=n(!1),e.push([t.i,'@charset "UTF-8";\r\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\r\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\r\n/* 颜色变量 */\r\n/* 水平间距 */\r\n/* 水平间距 */\r\n/* 行为相关颜色 */\r\n/* 兼容 uni-ui 相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */.flex.center[data-v-3c222688]{justify-content:center;align-items:center;color:#666}',""]),t.exports=e},"139d":function(t,e,a){"use strict";a.r(e);var n=a("ae58"),i=a("7279");for(var r in i)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(r);a("1b5d");var s=a("828b"),o=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"3c222688",null,!1,n["a"],void 0);e["default"]=o.exports},"199a5":function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return r})),a.d(e,"a",(function(){return n}));var n={uniTooltip:a("f3dd").default,uniIcons:a("7a23").default},i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"uni-stat--tab-x"},[t.label?a("v-uni-view",{staticClass:"uni-label-text hide-on-phone"},[t._v(t._s(t.label+"："))]):t._e(),a("v-uni-view",{staticClass:"uni-stat--tab"},[t.renderTabs.length?t._l(t.renderTabs,(function(e,n){return a("v-uni-view",{key:n,staticClass:"uni-stat--tab-item",class:[n===t.currentTab?"uni-stat--tab-item-"+t.type+"-active":"","uni-stat--tab-item-"+t.type,e.disabled?"uni-stat--tab-item-disabled":""],on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.change(e,n)}}},[a("uni-tooltip",{scopedSlots:t._u([e.tooltip?{key:"content",fn:function(){return[a("v-uni-view",{staticClass:"uni-stat-tooltip-s"},[t._v(t._s(e.tooltip))])]},proxy:!0}:null],null,!0)},[t._v(t._s(e.name)),e.tooltip?a("uni-icons",{attrs:{type:"help",color:"#666"}}):t._e()],1)],1)})):a("v-uni-view",{staticClass:"uni-stat--tab-item uni-stat--tab-item-disabled",class:["uni-stat--tab-item-"+t.type]},[t._v(t._s(t.placeholder))])],2)],1)},r=[]},"1b5d":function(t,e,a){"use strict";var n=a("b503"),i=a.n(n);i.a},"2e75":function(t,e,a){"use strict";(function(t){a("6a54");var n=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=n(a("9b1b"));a("e838"),a("fd3c"),a("5ef2"),a("64aa"),a("c223");var r=a("777c"),s=n(a("ae3e")),o=a("60a4"),c={props:{query:{type:[Object],default:function(){return{}}}},data:function(){return{tableName:"uni-stat-pay-result",fieldsMap:o.fieldsMap,chartData:{},errorMessage:"",notData:!1,opts:{color:["#1890FF","#91CB74","#FAC858","#EE6666","#73C0DE","#3CA272","#FC8452","#9A60B4","#ea7ccc"],padding:[15,15,0,15],extra:{funnel:{activeOpacity:.3,activeWidth:10,border:!0,borderWidth:2,borderColor:"#FFFFFF",fillOpacity:1,labelAlign:"right",linearType:"custom",minSize:20}}},dateTabs:{time:Date.now(),timeStr:"",index:0,list:[{_id:"day",name:"日维度"},{_id:"week",name:"周维度"},{_id:"month",name:"月维度"}]}}},created:function(){var t=this;this.getCloudDataDebounce=(0,r.debounce)((function(){t.getCloudData()}),400),this.getCloudDataDebounce()},methods:{calcPercentage:function(t,e){return e>0?parseFloat((t/e*100).toFixed(2)):0},getCloudData:function(){var e=this,a=this.query;if(a.appid){this.errorMessage="";var n=this.getWhere(),s=(0,i.default)((0,i.default)({},a),n);s=(0,r.stringifyQuery)(s,!1,["uni_platform"]);var c=t.database();c.collection(this.tableName).where(s).field("".concat((0,r.stringifyField)(o.fieldsMap),", dimension, stat_date.date_str as stat_time, start_time")).groupBy("null").groupField((0,r.stringifyGroupField)(o.fieldsMap)).get().then((function(t){var a=t.result.data;if(a.length){e.errorMessage="",a.map((function(t){for(var e in t)e.indexOf("_amount")>1&&(t[e]=Number((t[e]/100).toFixed(2)))}));var n=a[0]||{},i=n.activity_device_count,r=void 0===i?0:i,s=n.activity_user_count,o=void 0===s?0:s,c=n.pay_user_count,u=void 0===c?0:c;e.notData=!(r||o||u);var d={series:[{data:[{name:"活跃设备数量",value:r,centerText:"".concat(r),labelText:"活跃设备数"},{name:"活跃用户数量",value:o,centerText:"".concat(o),labelText:"活跃用户数（用户转化率：".concat(e.calcPercentage(o,r),"%）")},{name:"支付用户数量",value:u,centerText:"".concat(u),labelText:"支付用户数（支付转化率：".concat(e.calcPercentage(u,o),"%）")}]}]};e.chartData=d}else e.errorMessage="暂无数据"}))}else this.errorMessage="请先选择应用"},dateTabsChange:function(t,e){this.dateTabs.index=e,this.getCloudData()},datePickerChange:function(t){this.dateTabs.time=t,this.getCloudData()},getWhere:function(){var t=this.dateTabs.time,e=this.dateTabs.list[this.dateTabs.index]._id||"day",a=[];if("day"===e){var n=s.default.getOffsetStartAndEnd("day",0,t),i=n.startTime,r=n.endTime;a=[i,r]}else if("week"===e){var o=s.default.getOffsetStartAndEnd("week",0,t),c=o.startTime,u=o.endTime;a=[c,u]}else if("month"===e){var d=s.default.getOffsetStartAndEnd("month",0,t),l=d.startTime,f=d.endTime;a=[l,f]}return this.dateTabs.timeStr="".concat(s.default.timeFormat(a[0])," ~ ").concat(s.default.timeFormat(a[1])),{dimension:e,start_time:a}}},watch:{query:{deep:!0,handler:function(t){this.getCloudDataDebounce()}}},computed:{}};e.default=c}).call(this,a("861b")["default"])},3539:function(t,e,a){"use strict";a("6a54");var n=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a("777c"),r=(n(a("ae3e")),n(a("139d"))),s=n(a("fc1a")),o={components:{funnelChart:r.default,trendChart:s.default},data:function(){return{tableName:"uni-stat-pay-result",query:{dimension:"hour",appid:"",platform_id:"",uni_platform:"",version_id:"",start_time:[]},loading:!1}},onLoad:function(t){var e=t.appid;e&&(this.query.appid=e)},created:function(){},methods:{platformChange:function(t,e,a,n){this.query.version_id=0,this.query.uni_platform=n.code}},watch:{},computed:{versionQuery:function(){var t=this.query,e=t.appid,a=t.uni_platform,n=(0,i.stringifyQuery)({appid:e,uni_platform:a});return n},channelQuery:function(){var t=this.query,e=t.appid,a=t.platform_id,n=(0,i.stringifyQuery)({appid:e,platform_id:a});return n}}};e.default=o},"60a4":function(t,e,a){"use strict";a("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.fieldsMap=void 0;e.fieldsMap=[{title:"活跃设备数",field:"activity_device_count",tooltip:"统计时间内，访问设备数，一台设备多次访问被计为一台（包含未登录的用户）。",formatter:",",value:0,contrast:0,stat:"sum"},{title:"活跃用户数",field:"activity_user_count",tooltip:"活跃用户数：统计时间内，访问人数，一人多次访问被计为一人（只统计已登录的用户）。",formatter:",",value:0,contrast:0,stat:"sum"},{title:"支付用户数",field:"pay_user_count",tooltip:"统计时间内，成功支付的人数（不剔除退款订单）（只统计已登录的用户）。",formatter:",",value:0,contrast:0,stat:"sum"}]},"66bd":function(t,e,a){"use strict";var n=a("ab19"),i=a.n(n);i.a},"6cbd":function(t,e,a){var n=a("c86c");e=n(!1),e.push([t.i,'@charset "UTF-8";\r\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\r\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\r\n/* 颜色变量 */\r\n/* 水平间距 */\r\n/* 水平间距 */\r\n/* 行为相关颜色 */\r\n/* 兼容 uni-ui 相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */.uni-stat-tooltip-s[data-v-7bab379c]{width:160px;white-space:normal}.uni-label-text[data-v-7bab379c]{font-size:14px;font-weight:700;color:#555;margin-top:17px;margin-bottom:17px;margin-right:5px}.uni-stat--tab-x[data-v-7bab379c]{display:flex;margin:0 15px;white-space:nowrap}.uni-stat--tab[data-v-7bab379c]{display:flex;flex-wrap:wrap}.uni-stat--tab-item[data-v-7bab379c]{white-space:nowrap;font-size:14px;color:#666;text-align:center;cursor:pointer;box-sizing:border-box;margin:15px 0}.uni-stat--tab-item-disabled[data-v-7bab379c]{cursor:unset;opacity:.4}.uni-stat--tab-item-line[data-v-7bab379c]{margin-right:30px;padding:2px 0;border-bottom:1px solid transparent}.uni-stat--tab-item-line[data-v-7bab379c]:last-child{margin-right:0}.uni-stat--tab-item-line-active[data-v-7bab379c]{color:#2979ff;border-bottom:1px solid #2979ff}.uni-stat--tab-item-boldLine[data-v-7bab379c]{box-sizing:border-box;margin-right:30px;padding:2px 0;border-bottom:2px solid transparent}.uni-stat--tab-item-boldLine[data-v-7bab379c]:last-child{margin-right:0}.uni-stat--tab-item-boldLine-active[data-v-7bab379c]{box-sizing:border-box;color:#2979ff;border-bottom:2px solid #2979ff}.uni-stat--tab-item-box[data-v-7bab379c]{padding:5px 15px;border:1px solid #dcdfe6}.uni-stat--tab-item-box[data-v-7bab379c]:not(:last-child){border-right-color:transparent}.uni-stat--tab-item-box-active[data-v-7bab379c]{box-sizing:border-box;border:1px solid #2979ff!important}@media screen and (max-width:500px){.hide-on-phone[data-v-7bab379c]{display:none}.uni-stat--tab[data-v-7bab379c]{flex-wrap:unset;overflow-x:auto!important}[data-v-7bab379c]::-webkit-scrollbar{display:none}}',""]),t.exports=e},7279:function(t,e,a){"use strict";a.r(e);var n=a("2e75"),i=a.n(n);for(var r in n)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(r);e["default"]=i.a},"73b3":function(t,e,a){"use strict";a.r(e);var n=a("3539"),i=a.n(n);for(var r in n)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(r);e["default"]=i.a},7817:function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return r})),a.d(e,"a",(function(){return n}));var n={uniStatBreadcrumb:a("ce4e").default,uniDataSelect:a("9c5f").default,uniStatTabs:a("c541").default},i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"fix-top-window"},[a("v-uni-view",{staticClass:"uni-header"},[a("uni-stat-breadcrumb",{staticClass:"uni-stat-breadcrumb-on-phone"})],1),a("v-uni-view",{staticClass:"uni-container"},[a("v-uni-view",{staticClass:"uni-stat--x flex p-1015"},[a("v-uni-view",{staticClass:"uni-stat--app-select"},[a("uni-data-select",{attrs:{collection:"opendb-app-list",field:"appid as value, name as text",orderby:"text asc","def-item":1,label:"应用选择",clear:!1},model:{value:t.query.appid,callback:function(e){t.$set(t.query,"appid",e)},expression:"query.appid"}}),a("uni-data-select",{staticClass:"ml-m",attrs:{collection:"opendb-app-versions",where:t.versionQuery,field:"_id as value, version as text, uni_platform as label, create_date as date",format:"{label} - {text}",orderby:"date desc",label:"版本选择"},model:{value:t.query.version_id,callback:function(e){t.$set(t.query,"version_id",e)},expression:"query.version_id"}})],1)],1),a("v-uni-view",{staticClass:"uni-stat--x"},[a("uni-stat-tabs",{attrs:{label:"平台选择",type:"boldLine",mode:"platform"},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.platformChange.apply(void 0,arguments)}},model:{value:t.query.platform_id,callback:function(e){t.$set(t.query,"platform_id",e)},expression:"query.platform_id"}}),t.query.platform_id&&-1===t.query.platform_id.indexOf("==")?a("uni-data-select",{ref:"version-select",staticClass:"p-channel",attrs:{collection:"uni-stat-app-channels",where:t.channelQuery,field:"_id as value, channel_name as text",orderby:"text asc",label:"渠道/场景值选择"},model:{value:t.query.channel_id,callback:function(e){t.$set(t.query,"channel_id",e)},expression:"query.channel_id"}}):t._e()],1),a("funnelChart",{attrs:{query:t.query}}),a("trendChart",{attrs:{query:t.query}})],1)],1)},r=[]},"934b":function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return r})),a.d(e,"a",(function(){return n}));var n={uniStatTabs:a("c541").default,uniDatetimePicker:a("2e94").default,qiunDataCharts:a("bbf1").default},i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"uni-stat--x p-m"},[a("v-uni-view",{staticClass:"uni-stat-card-header"},[t._v("趋势图")]),a("v-uni-view",{staticClass:"flex"},[a("uni-stat-tabs",{attrs:{type:"box",current:t.dateTabs.index,tabs:t.dateTabs.list},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.dateTabsChange.apply(void 0,arguments)}}}),a("uni-datetime-picker",{staticClass:"uni-stat-datetime-picker",attrs:{type:"datetimerange",end:Date.now(),"return-type":"timestamp","clear-icon":!1},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.datePickerChange.apply(void 0,arguments)}},model:{value:t.dateTabs.time,callback:function(e){t.$set(t.dateTabs,"time",e)},expression:"dateTabs.time"}}),t.dateTabs.timeStr?a("v-uni-view",{staticClass:"uni-stat--tips"},[t._v("当前时间范围："+t._s(t.dateTabs.timeStr))]):t._e()],1),a("uni-stat-tabs",{staticClass:"mb-l",attrs:{type:"box",current:t.statTabs.index,tabs:t.statTabs.list},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.statTabsChange.apply(void 0,arguments)}}}),a("v-uni-view",{staticClass:"uni-charts-box"},[a("qiun-data-charts",{attrs:{type:"area",chartData:t.chartData,opts:t.opts,errorMessage:t.errorMessage}})],1)],1)},r=[]},ab19:function(t,e,a){var n=a("6cbd");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var i=a("967d").default;i("256c0852",n,!0,{sourceMap:!1,shadowMode:!1})},ae3e:function(t,e,a){"use strict";a("6a54");var n=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=n(a("fcf3"));a("64aa"),a("c9b5"),a("bf0f"),a("ab80"),a("5c47"),a("0506"),a("a1c1"),a("23f4"),a("7d2f"),a("9c4e"),a("c223"),a("5ef2");var r={getDateObject:function(t){return t?("string"!==typeof t||isNaN(t)||(t=Number(t)),"number"===typeof t?(10===t.toString().length&&(t*=1e3),e=new Date(t)):"object"===(0,i.default)(t)&&(e=new Date(t.getTime())),e):"";var e},timeFormat:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yyyy-MM-dd hh:mm:ss";try{if(!t)return"";var a=r.getDateObject(t),n={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};for(var i in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length))),n)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?n[i]:("00"+n[i]).substr((""+n[i]).length)));return e}catch(s){return time}},getDateInfo:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,e=r.getDateObject(t),a=e.getFullYear()+"",n=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,i=e.getDate()<10?"0"+e.getDate():e.getDate(),s=e.getHours()<10?"0"+e.getHours():e.getHours(),o=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),c=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds(),u=e.getMilliseconds(),d=e.getDay(),l=Math.floor((e.getMonth()+3)/3);return{year:Number(a),month:Number(n),day:Number(i),hour:Number(s),minute:Number(o),second:Number(c),millisecond:Number(u),week:Number(d),quarter:Number(l)}},getOffsetStartAndEnd:function(){var t,e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"day",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date,s=r.getDateObject(i);if("hour"===a){var o=36e5,c=r.getDateInfo(new Date(s.getTime()+1*o*n));t=new Date("".concat(c.year,"/").concat(c.month,"/").concat(c.day," ").concat(c.hour,":00:00")).getTime(),e=new Date("".concat(c.year,"/").concat(c.month,"/").concat(c.day," ").concat(c.hour,":00:00")).getTime()+(o-1)}else if("day"===a){var u=864e5,d=r.getDateInfo(new Date(s.getTime()+1*u*n));t=new Date("".concat(d.year,"/").concat(d.month,"/").concat(d.day)).getTime(),e=new Date("".concat(d.year,"/").concat(d.month,"/").concat(d.day)).getTime()+(u-1)}else if("week"===a){s.setDate(s.getDate()-s.getDay()+1+7*n);var l=r.getDateInfo(s);s.setDate(s.getDate()+7);var f=r.getDateInfo(s);t=new Date("".concat(l.year,"/").concat(l.month,"/").concat(l.day)).getTime(),e=new Date("".concat(f.year,"/").concat(f.month,"/").concat(f.day)).getTime()-1}else if("month"===a){var b=r.getDateInfo(s),h=b.month+n,m=b.year;h>12?(m+=Math.floor(h/12),h=Math.abs(h)%12):h<=0&&(m=m-1-Math.floor(Math.abs(h)/12),h=12-Math.abs(h)%12);var p=new Date(m,h,0).getDate();t=new Date("".concat(m,"/").concat(h,"/1")).getTime(),e=new Date("".concat(m,"/").concat(h,"/").concat(p)).getTime()+86399999}else if("quarter"===a){s.setMonth(s.getMonth()+3*n);var v=r.getDateInfo(s),g=v.month;[1,2,3].indexOf(g)>-1?g=1:[4,5,6].indexOf(g)>-1?g=4:[7,8,9].indexOf(g)>-1?g=7:[10,11,12].indexOf(g)>-1&&(g=10),s.setMonth(g-1);var y=r.getDateInfo(s);s.setMonth(s.getMonth()+3);var x=r.getDateInfo(s);t=new Date("".concat(y.year,"/").concat(y.month,"/1")).getTime(),e=new Date("".concat(x.year,"/").concat(x.month,"/1")).getTime()-1}else if("year"===a){var _=r.getDateInfo(s),T=_.year+n;t=new Date("".concat(T,"/1/1")).getTime(),e=new Date("".concat(T,"/12/31")).getTime()+86399999}return{startTime:t,endTime:e}}},s=r;e.default=s},ae58:function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return r})),a.d(e,"a",(function(){return n}));var n={uniStatTabs:a("c541").default,uniDatetimePicker:a("2e94").default,qiunDataCharts:a("bbf1").default},i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"uni-stat--x p-m"},[a("v-uni-view",{staticClass:"uni-stat-card-header"},[t._v("漏斗分析")]),a("v-uni-view",{staticClass:"flex"},[a("uni-stat-tabs",{attrs:{type:"box",current:t.dateTabs.index,tabs:t.dateTabs.list},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.dateTabsChange.apply(void 0,arguments)}}}),a("uni-datetime-picker",{staticClass:"uni-stat-datetime-picker",attrs:{type:"date",end:Date.now(),"return-type":"timestamp","clear-icon":!1},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.datePickerChange.apply(void 0,arguments)}},model:{value:t.dateTabs.time,callback:function(e){t.$set(t.dateTabs,"time",e)},expression:"dateTabs.time"}}),t.dateTabs.timeStr?a("v-uni-view",{staticClass:"uni-stat--tips"},[t._v("当前时间范围："+t._s(t.dateTabs.timeStr))]):t._e()],1),t.notData?a("v-uni-view",{staticClass:"uni-charts-box flex center"},[a("v-uni-view",[t._v("暂无数据")])],1):a("v-uni-view",{staticClass:"uni-charts-box"},[a("qiun-data-charts",{attrs:{type:"funnel",chartData:t.chartData,opts:t.opts,errorMessage:t.errorMessage}})],1)],1)},r=[]},b162:function(t,e,a){"use strict";(function(t){a("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("64aa"),a("5c47"),a("a1c1"),a("5ef2"),a("3efd"),a("8f71"),a("bf0f"),a("4100"),a("0506"),a("fd3c");var n={name:"uni-stat-tabs",data:function(){return{currentTab:0,renderTabs:[],cacheKey:"uni-admin-statTabsData"}},props:{type:{type:String,default:"line"},value:{type:[String,Number],default:""},modelValue:{type:[String,Number],default:""},current:{type:[String,Number],default:0},mode:{type:String,default:""},today:{type:Boolean,default:!1},yesterday:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},tooltip:{type:Boolean,default:!1},all:{type:Boolean,default:!0},label:{type:String,default:""},placeholder:{type:String,default:"暂无选项"},tabs:{type:Array,default:function(){return[]}}},created:function(){this.last="".concat(this.mode.replace("-","_"),"_last_data")},mounted:function(){this.init()},computed:{},watch:{current:{immediate:!0,handler:function(t){this.currentTab=t}},tabs:{immediate:!1,handler:function(t){this.init()}},renderTabs:function(t){var e=this.current;this.mode&&t.length&&e>=0&&this.$nextTick((function(){var t=this.renderTabs[e];this.change(t,e)}))}},methods:{init:function(){if(this.mode.indexOf("platform")>-1)this.renderTabs=this.getCache()||[],this.getPlatform();else if("date"===this.mode){var t=[{_id:7,name:"最近七天"},{_id:30,name:"最近30天"},{_id:90,name:"最近90天"}];this.yesterday&&t.unshift({_id:1,name:"昨天"}),this.today&&t.unshift({_id:0,name:"今天"}),this.renderTabs=t}else this.renderTabs=this.tabs},change:function(t,e){if(!t.disabled){var a=t._id,n=t.name;this.currentTab=e,this.emit(a,e,n,t)}},emit:function(t,e,a,n){this.$emit("change",t,e,a,n),this.$emit("input",t,e,a),this.$emit("update:modelValue",t,e,a)},getPlatform:function(){var e=this,a=t.database();a.collection("uni-stat-app-platforms").get().then((function(t){var a=t.result.data;if(a=a.filter((function(t){return!t.hasOwnProperty("enable")||t.enable})),a.sort((function(t,e){return t.order-e.order})),"platform-channel"===e.mode){a=a.filter((function(t){return/^android|ios$/.test(t.code)}));var n=a.map((function(t){return'platform_id == "'.concat(t._id,'"')})).join(" || ");n="(".concat(n,")"),e.setAllItem(a,n)}else if("platform-scene"===e.mode){a=a.filter((function(t){return/mp-/.test(t.code)}));var i=a.map((function(t){return'platform_id == "'.concat(t._id,'"')})).join(" || ");i="(".concat(i,")"),e.setAllItem(a,i)}else e.setAllItem(a);e.setCache(a),e.renderTabs=a}))},setAllItem:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"全部";this.all&&t.unshift({name:a,_id:e})},getCurrentCacheKey:function(){return this.mode},getCache:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getCurrentCacheKey(),e=uni.getStorageSync(this.cacheKey)||{};return e[t]},setCache:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getCurrentCacheKey(),a=uni.getStorageSync(this.cacheKey)||{};a[e]=t,uni.setStorageSync(this.cacheKey,a)},removeCache:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getCurrentCacheKey(),e=uni.getStorageSync(this.cacheKey)||{};delete e[t],uni.setStorageSync(this.cacheKey,e)}}};e.default=n}).call(this,a("861b")["default"])},b503:function(t,e,a){var n=a("0dd9");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var i=a("967d").default;i("3680768e",n,!0,{sourceMap:!1,shadowMode:!1})},c541:function(t,e,a){"use strict";a.r(e);var n=a("199a5"),i=a("fbfc");for(var r in i)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(r);a("66bd");var s=a("828b"),o=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"7bab379c",null,!1,n["a"],void 0);e["default"]=o.exports},cda7:function(t,e,a){"use strict";(function(t){a("6a54");var n=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("bf0f"),a("fd3c"),a("64aa"),a("aa9c"),a("c223");var i=n(a("3471")),r=n(a("9b1b")),s=a("777c"),o=n(a("ae3e")),c=a("60a4"),u={props:{query:{type:[Object],default:function(){return{}}}},data:function(){return{tableName:"uni-stat-pay-result",chartData:{},errorMessage:"",opts:{color:["#1890FF","#91CB74","#FAC858","#EE6666","#73C0DE","#3CA272","#FC8452","#9A60B4","#ea7ccc"],padding:[15,15,0,15],legend:{},enableScroll:!0,xAxis:{disableGrid:!0,itemCount:24,fontSize:12},yAxis:{gridType:"dash",dashLength:2,data:[{tofix:2,unit:"%"}]},extra:{area:{type:"straight",opacity:.2,addLine:!0,width:2,gradient:!1}}},dateTabs:{time:[],timeStr:"",index:0,list:[{_id:7,name:"最近七天",dimension:"day"},{_id:30,name:"最近30天",dimension:"day"},{_id:90,name:"最近90天",dimension:"day"},{_id:372,name:"月维度",dimension:"month"},{_id:1116,name:"季维度",dimension:"quarter"},{_id:4392,name:"年维度",dimension:"year"}]},statTabs:{index:0,list:[{_id:1,name:"支付转化率"}]},queryMode:0}},created:function(){var t=this;this.getCloudDataDebounce=(0,s.debounce)((function(){t.getCloudData()}),300),this.getCloudDataDebounce()},methods:{getCloudData:function(){var e=this,a=this.query;if(a.appid){this.errorMessage="";var n=this.getWhere(),i=(0,r.default)((0,r.default)({},a),n);i=(0,s.stringifyQuery)(i,!0,["uni_platform"]);var o=t.database();o.collection(this.tableName).where(i).field("".concat((0,s.stringifyField)(c.fieldsMap),", start_time")).groupBy("start_time, dimension").groupField((0,s.stringifyGroupField)(c.fieldsMap)).orderBy("start_time","asc").limit(100).get({getCount:!0}).then((function(t){var a=t.result,i=(a.count,a.data);i=(0,s.fillTrendChartData)(i,n,c.fieldsMap),i.map((function(t,e){t.value=Number((t.pay_user_count/t.activity_user_count*100).toFixed(2)),isNaN(t.value)&&(t.value=0)})),e.setChartData(i,n.dimension)})).catch((function(t){})).finally((function(){}))}else this.errorMessage="请先选择应用"},setChartData:function(t,e){var a,n={categories:[],series:[{name:"支付转化率",data:[]}]},r=(0,i.default)(t);try{for(r.s();!(a=r.n()).done;){var s=a.value,o=this.formatDate(s.start_time,e);n.categories.push(o);var c=Number(s.value);n.series[0].data.push(c)}}catch(u){r.e(u)}finally{r.f()}this.chartData=n},formatDate:function(t,e){var a=new Date(t),n=a.getFullYear(),i=a.getMonth()+1,r=a.getDate(),o=a.getHours(),c=Math.floor((a.getMonth()+3)/3);return i<10&&(i="0"+i),r<10&&(r="0"+r),"hour"===e?"".concat(o,"时"):"month"===e?"".concat(n,"-").concat(i):"quarter"===e?"".concat(n,"/Q").concat(c):"year"===e?"".concat(n):(0,s.parseDateTime)(a)},datePickerChange:function(t){this.dateTabs.time=t,this.queryMode=1,this.getCloudData()},dateTabsChange:function(t,e){this.dateTabs.index=e,this.queryMode=0,this.getCloudData()},statTabsChange:function(t,e,a){this.statTabs.index=e,this.getCloudData({field:t,name:a})},getWhere:function(){var t=[],e=this.dateTabs.list[this.dateTabs.index]||{};if("number"===typeof e._id&&0===this.queryMode){var a=(0,s.getTimeOfSomeDayAgo)(e._id),n=o.default.getOffsetStartAndEnd("day",0).endTime;1==e._id&&(n=o.default.getOffsetStartAndEnd("day",0,a).endTime),t=[a,n]}else this.dateTabs.time&&(t=this.dateTabs.time);var i=e.dimension||"day";return this.dateTabs.timeStr="".concat(o.default.timeFormat(t[0])," ~ ").concat(o.default.timeFormat(t[1])),this.dateTabs.time=t,{dimension:i,start_time:t}}},watch:{query:{deep:!0,handler:function(t){this.getCloudDataDebounce()}}},computed:{}};e.default=u}).call(this,a("861b")["default"])},cf8a:function(t,e,a){"use strict";a.r(e);var n=a("7817"),i=a("73b3");for(var r in i)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(r);var s=a("828b"),o=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);e["default"]=o.exports},ebb3:function(t,e,a){"use strict";a.r(e);var n=a("cda7"),i=a.n(n);for(var r in n)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(r);e["default"]=i.a},fbfc:function(t,e,a){"use strict";a.r(e);var n=a("b162"),i=a.n(n);for(var r in n)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(r);e["default"]=i.a},fc1a:function(t,e,a){"use strict";a.r(e);var n=a("934b"),i=a("ebb3");for(var r in i)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(r);var s=a("828b"),o=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"73b5ea74",null,!1,n["a"],void 0);e["default"]=o.exports}}]);